<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js et A-Frame - Cube Géolocalisé avec Distance</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/examples/gps/gps-entity-place.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
        <!-- Ajouter un cube géolocalisé -->
        <a-box id="geolocated-box" position="0 0.5 -3" rotation="0 45 45" color="#4CC3D9"
               gps-entity-place="latitude: 43.6007035742367; longitude: 1.4357006549835205;">
        </a-box>

        <!-- Ajouter la caméra -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Fonction pour calculer la distance entre deux points GPS
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Rayon de la Terre en mètres
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distance en mètres
        }

        // Fonction pour obtenir la position actuelle de l'utilisateur
        function getUserPosition(callback) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(callback);
            } else {
                console.error("La géolocalisation n'est pas supportée par ce navigateur.");
            }
        }

        // Fonction pour afficher la distance en temps réel
        function logDistance() {
            const box = document.querySelector('#geolocated-box');
            const boxPosition = box.getAttribute('gps-entity-place').position;
            const boxLat = boxPosition.latitude;
            const boxLon = boxPosition.longitude;

            getUserPosition((position) => {
                const userLat = position.coords.latitude;
                const userLon = position.coords.longitude;
                const distance = calculateDistance(userLat, userLon, boxLat, boxLon);
                console.log(`Distance de l'objet : ${distance.toFixed(2)} mètres`);
            });
        }

        // Appeler la fonction logDistance toutes les secondes
        setInterval(logDistance, 1000);
    </script>
</body>
</html>
